<% content_for :title, "Images" %>

<div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8">
  <!-- Header -->
  <div class="text-center mb-6 md:mb-8">
    <h1 class="font-black mb-4" style="font-size: clamp(3rem, 6vw, 4rem); color: var(--text-primary); letter-spacing: -0.03em;">AI Generated Images</h1>
    <p class="font-medium" style="font-size: clamp(1.25rem, 2vw, 1.75rem); color: var(--text-secondary); letter-spacing: -0.01em;">Routed to my local GPU via ComfyUI</p>
  </div>
  <div class="flex justify-center mb-6">
    <%= link_to "Generate with AI", ai_generate_images_path,
                class: "px-6 py-3 text-base font-medium rounded-lg transition-all hover:opacity-90 hover:scale-105",
                style: "background: linear-gradient(45deg, #10b981, #059669); color: #fff;" %>
  </div>

  <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-2">
    <% # Display AI-generated images first %>
    <% @ai_images.each do |ai_image| %>
      <%= link_to ai_show_image_path(ai_image[:id]),
                  class: "group block rounded overflow-hidden transition-all hover:scale-105 hover:z-10 relative",
                  style: "background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);" do %>
        <div class="relative" style="padding-bottom: 100%;">
          <img src="data:image/png;base64,<%= ai_image[:base64] %>"
               class="absolute inset-0 w-full h-full object-cover"
               loading="lazy" />
          <% if ai_image[:batch_size] && ai_image[:batch_size] > 1 %>
            <div class="absolute top-1 right-1 px-1.5 py-0.5 text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity"
                 style="background: rgba(0,0,0,0.7); color: #fff;">
              <%= ai_image[:batch_size] %> images
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <% # Display regular uploaded images %>
    <% @images.each do |image| %>
      <%= link_to image_path(image),
                  class: "group block rounded overflow-hidden transition-all hover:scale-105 hover:z-10",
                  style: "background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);" do %>
        <div class="relative" style="padding-bottom: 100%;">
          <% if image.file.attached? %>
            <%= image_tag image.file.variant(resize_to_fill: [200, 200]),
                          class: "absolute inset-0 w-full h-full object-cover",
                          loading: "lazy" %>
          <% else %>
            <div class="absolute inset-0 flex items-center justify-center"
                 style="background: rgba(255,255,255,0.02);">
              <span style="color: rgba(255,255,255,0.3);">No image</span>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>

  <% if @images.empty? && @ai_images.empty? %>
    <div class="text-center py-12">
      <p style="color: rgba(255,255,255,0.5);" class="mb-4">No images yet</p>
      <%= link_to "Generate with AI", ai_generate_images_path,
                  style: "color: #10b981;" %>
    </div>
  <% end %>
</div>