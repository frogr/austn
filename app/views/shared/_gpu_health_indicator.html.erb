<%# Usage: render "shared/gpu_health_indicator", service: "images" %>
<% status = GpuHealthStatus.for_service(service) %>
<span class="gpu-health-indicator inline-flex items-center gap-1.5 group relative" data-service="<%= service %>">
  <span class="relative flex h-2.5 w-2.5">
    <% if status.online %>
      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
      <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
    <% else %>
      <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"></span>
    <% end %>
  </span>

  <%# Tooltip %>
  <span class="invisible group-hover:visible absolute left-1/2 -translate-x-1/2 top-full mt-2 px-3 py-2 text-xs rounded-lg shadow-lg whitespace-nowrap z-50"
        style="background: rgba(23, 23, 23, 0.95); border: 1px solid rgba(255,255,255,0.1); color: rgba(255,255,255,0.9);">
    <span class="block font-medium mb-1">
      GPU Status: <%= status.online ? "Online" : "Offline" %>
    </span>
    <% if status.last_online_at.present? %>
      <span class="block text-gray-400">
        Last online: <%= time_ago_in_words(status.last_online_at) %> ago
      </span>
    <% elsif status.last_checked_at.present? %>
      <span class="block text-gray-400">
        Last checked: <%= time_ago_in_words(status.last_checked_at) %> ago
      </span>
    <% else %>
      <span class="block text-gray-400">Never checked</span>
    <% end %>
    <% if status.error_message.present? %>
      <span class="block text-red-400 mt-1 text-[10px] max-w-48 truncate">
        <%= status.error_message.truncate(60) %>
      </span>
    <% end %>
    <%# Tooltip arrow %>
    <span class="absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 rotate-45"
          style="background: rgba(23, 23, 23, 0.95); border-left: 1px solid rgba(255,255,255,0.1); border-top: 1px solid rgba(255,255,255,0.1);"></span>
  </span>
</span>
