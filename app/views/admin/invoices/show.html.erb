<div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8 max-w-4xl">
  <% if notice.present? %>
    <div class="mb-4 p-3 rounded-md bg-green-900/50 text-green-300 border border-green-700 text-sm"><%= notice %></div>
  <% end %>
  <% if alert.present? %>
    <div class="mb-4 p-3 rounded-md bg-red-900/50 text-red-300 border border-red-700 text-sm"><%= alert %></div>
  <% end %>

  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4">
    <div>
      <h1 class="font-black mb-1" style="font-size: clamp(1.5rem, 3vw, 2rem); color: var(--text-primary); letter-spacing: -0.03em;">
        <%= @invoice.invoice_number %>
      </h1>
      <p class="text-gray-400 text-sm">
        <%= @invoice.client.name %> &mdash; <%= invoice_status_badge(@invoice.status) %>
      </p>
    </div>
    <div class="flex flex-wrap gap-2">
      <%= link_to admin_invoices_path, class: "inline-flex items-center gap-1 font-semibold py-2 px-4 rounded-md transition duration-200 text-white bg-gray-700 hover:bg-gray-600 text-sm" do %>
        All Invoices
      <% end %>
      <%= link_to edit_admin_invoice_path(@invoice), class: "inline-flex items-center gap-1 font-semibold py-2 px-4 rounded-md transition duration-200 text-white bg-yellow-600 hover:bg-yellow-500 text-sm" do %>
        <span class="material-icons" style="font-size: 16px;">edit</span> Edit
      <% end %>
      <%= link_to pdf_admin_invoice_path(@invoice), target: "_blank", class: "inline-flex items-center gap-1 font-semibold py-2 px-4 rounded-md transition duration-200 text-white bg-blue-600 hover:bg-blue-500 text-sm" do %>
        <span class="material-icons" style="font-size: 16px;">picture_as_pdf</span> PDF
      <% end %>
      <% if @invoice.status == "draft" %>
        <%= link_to send_invoice_admin_invoice_path(@invoice), data: { turbo_method: :post, turbo_confirm: "Send this invoice to #{@invoice.client.email}?" }, class: "inline-flex items-center gap-1 font-semibold py-2 px-4 rounded-md transition duration-200 text-white bg-green-600 hover:bg-green-500 text-sm" do %>
          <span class="material-icons" style="font-size: 16px;">send</span> Send
        <% end %>
      <% end %>
      <% if @invoice.status != "paid" %>
        <%= link_to mark_paid_admin_invoice_path(@invoice), data: { turbo_method: :post, turbo_confirm: "Mark this invoice as paid?" }, class: "inline-flex items-center gap-1 font-semibold py-2 px-4 rounded-md transition duration-200 text-black text-sm", style: "background: var(--accent-color);" do %>
          <span class="material-icons" style="font-size: 16px;">paid</span> Mark Paid
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Invoice Preview Card -->
  <div class="rounded-lg p-6 sm:p-8 mb-6" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row justify-between mb-8">
      <div>
        <h2 class="text-xl font-bold text-white mb-1">AUSTIN FRENCH</h2>
        <p class="text-gray-400 text-sm">Senior Software Engineer</p>
        <p class="text-gray-400 text-sm">Turlock, CA</p>
        <p class="text-gray-400 text-sm">hi@austn.net</p>
        <p class="text-gray-400 text-sm">austn.net</p>
      </div>
      <div class="mt-4 sm:mt-0 sm:text-right">
        <p class="text-lg font-bold text-gray-300">INVOICE</p>
        <p class="text-white font-medium"><%= @invoice.invoice_number %></p>
        <p class="text-gray-400 text-sm mt-2">Date: <%= @invoice.issue_date.strftime("%b %d, %Y") %></p>
        <p class="text-gray-400 text-sm">Due: <%= @invoice.due_date.strftime("%b %d, %Y") %></p>
      </div>
    </div>

    <div class="h-px mb-6" style="background: var(--accent-color);"></div>

    <!-- Bill To -->
    <div class="mb-6">
      <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Bill To</p>
      <p class="text-white font-medium"><%= @invoice.client.name %></p>
      <p class="text-gray-400 text-sm"><%= @invoice.client.address_line1 %></p>
      <% if @invoice.client.address_line2.present? %>
        <p class="text-gray-400 text-sm"><%= @invoice.client.address_line2 %></p>
      <% end %>
      <p class="text-gray-400 text-sm"><%= @invoice.client.city %>, <%= @invoice.client.state %> <%= @invoice.client.zip %></p>
    </div>

    <!-- Line Items Table -->
    <div class="overflow-x-auto mb-6">
      <table class="w-full">
        <thead>
          <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
            <th class="text-left py-2 text-sm font-semibold text-gray-400">Description</th>
            <th class="text-right py-2 text-sm font-semibold text-gray-400 w-20">Qty</th>
            <th class="text-right py-2 text-sm font-semibold text-gray-400 w-28">Rate</th>
            <th class="text-right py-2 text-sm font-semibold text-gray-400 w-28">Amount</th>
          </tr>
        </thead>
        <tbody>
          <% @invoice.line_items.each do |li| %>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
              <td class="py-3 text-sm text-white"><%= li.description %></td>
              <td class="py-3 text-sm text-gray-300 text-right"><%= li.quantity % 1 == 0 ? li.quantity.to_i : li.quantity %></td>
              <td class="py-3 text-sm text-gray-300 text-right"><%= format_money(li.unit_price_cents) %></td>
              <td class="py-3 text-sm text-white text-right font-medium"><%= format_money(li.total_cents) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Totals -->
    <div class="flex justify-end">
      <div class="w-64 space-y-2">
        <div class="flex justify-between text-sm">
          <span class="text-gray-400">Subtotal</span>
          <span class="text-white"><%= format_money(@invoice.subtotal_cents) %></span>
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-gray-400">Tax (<%= @invoice.tax_rate %>%)</span>
          <span class="text-white"><%= format_money(@invoice.tax_cents) %></span>
        </div>
        <div class="flex justify-between text-base font-bold pt-2" style="border-top: 1px solid rgba(255,255,255,0.1);">
          <span class="text-white">TOTAL</span>
          <span style="color: var(--accent-color);"><%= format_money(@invoice.total_cents) %></span>
        </div>
      </div>
    </div>

    <% if @invoice.notes.present? %>
      <div class="mt-6 pt-4" style="border-top: 1px solid rgba(255,255,255,0.05);">
        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1">Notes</p>
        <p class="text-gray-400 text-sm"><%= @invoice.notes %></p>
      </div>
    <% end %>
  </div>

  <!-- Activity Log -->
  <div class="rounded-lg p-6 mb-6" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);">
    <h3 class="text-white font-semibold mb-3">Activity</h3>
    <div class="space-y-2">
      <div class="flex items-center gap-3 text-sm">
        <span class="material-icons text-gray-500" style="font-size: 16px;">add_circle</span>
        <span class="text-gray-400">Created <%= @invoice.created_at.strftime("%b %d, %Y at %I:%M %p") %></span>
      </div>
      <% if @invoice.sent_at.present? %>
        <div class="flex items-center gap-3 text-sm">
          <span class="material-icons text-blue-400" style="font-size: 16px;">send</span>
          <span class="text-gray-400">Sent <%= @invoice.sent_at.strftime("%b %d, %Y at %I:%M %p") %></span>
        </div>
      <% end %>
      <% if @invoice.paid_at.present? %>
        <div class="flex items-center gap-3 text-sm">
          <span class="material-icons text-green-400" style="font-size: 16px;">paid</span>
          <span class="text-gray-400">Paid <%= @invoice.paid_at.strftime("%b %d, %Y at %I:%M %p") %></span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Danger zone -->
  <div class="flex items-center justify-between pt-4" style="border-top: 1px solid rgba(255,255,255,0.05);">
    <%= link_to admin_invoices_path, class: "text-gray-500 hover:text-gray-300 text-sm" %>
    <%= link_to "Delete Invoice", admin_invoice_path(@invoice), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this invoice?" }, class: "text-red-500 hover:text-red-400 text-sm" %>
  </div>
</div>
